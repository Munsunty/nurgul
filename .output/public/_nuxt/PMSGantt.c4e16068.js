var J=Object.defineProperty;var O=(k,e,t)=>e in k?J(k,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):k[e]=t;var i=(k,e,t)=>(O(k,typeof e!="symbol"?e+"":e,t),t);import Q from"./TaskRect.8885232c.js";import{a as Z,r as m,j as K,b as $,e as x,o as u,l as w,h as B,f as l,w as y,u as d,F as S,S as E,c as T,T as V,t as X,P as M,i as ee}from"./entry.cee4e10b.js";import"./taskRelationLine.c8720a4a.js";class z{constructor(e,t){i(this,"id");i(this,"name");i(this,"date");i(this,"duration");i(this,"dependency");i(this,"column");i(this,"columnKey");i(this,"columnValue");i(this,"index");i(this,"selected");i(this,"manager");i(this,"progress");i(this,"endDate");this.id=e.id,this.name=e.name,this.date=e.date,this.duration=e.duration,this.dependency=e.dependency,this.manager=e.manager,this.progress=e.progress,this.endDate=this.getEndDate(),this.columnKey=this.getColumnKey(),this.columnValue=this.duration,this.column=this.getColumn(),this.index=t,this.selected=!1}reConstructor(e){this.id=e.id,this.name=e.name,this.date=e.date,this.duration=e.duration,this.dependency=e.dependency,this.manager=e.manager,this.progress=e.progress,this.endDate=this.getEndDate(),this.columnKey=this.getColumnKey(),this.columnValue=this.duration,this.column=this.getColumn(),this.selected=!1}getEndDate(){return this.endDate=this.date+this.duration-1}getColumnKey(){return this.date+"th"}getColumn(){return{[this.columnKey]:this.columnValue}}changeDate(e){this.date=e,this.endDate=this.getEndDate(),this.columnKey=this.getColumnKey(),this.column=this.getColumn()}changeDuration(e){this.duration=e,this.endDate=this.getEndDate(),this.columnValue=e,this.column=this.getColumn()}}class te{constructor(e,t,n){i(this,"tasks");i(this,"taskSet");i(this,"width");i(this,"height");i(this,"_get");i(this,"_add");i(this,"_delete");i(this,"_reIndex");i(this,"_clearUndefined");this.tasks=[],this.taskSet=new Set,this.width=t,this.height=n;let o=this;e.forEach(p=>{o.add(p)}),this.tasks.filter(p=>p.dependency).forEach(p=>o.calculatorCoordT(p)),this._get=this.get,this._add=this.add,this._delete=this.delete,this._clearUndefined=p=>{o.taskSet.delete(void 0),o.taskSet.add(p)}}get(){return this.tasks}add(e){this.taskSet.has(e.id)||(this.taskSet.add(e.id),this.tasks.push(new z(e,this.tasks.length)))}delete(e){if(this.taskSet.has(e)){let t=this.tasks.find(n=>n.id===e);t instanceof z&&(this.tasks.splice(t.index,1),this.reIndex())}}reIndex(){this.tasks.forEach((e,t)=>{e.index=t})}findTask(e){if(this.taskSet.has(e))return this.tasks.find(t=>t.id===e)}changeDateTask(e,t){e.changeDate(t),e.dependency instanceof Array&&this.calculatorCoordT(e),this.reArrangeCoord(e)}changeDurationTask(e,t){e.changeDuration(t),e.dependency instanceof Array&&this.calculatorCoordT(e),this.reArrangeCoord(e)}calculatorCoord(e,t,n){this.width=t,this.height=n,this.calculatorCoordT(e)}calculatorCoordT(e){let t=this;e.dependency.forEach(n=>{let o=t.findTask(n.id);o instanceof z&&(n.coordinate={x1:(e.duration+e.date-1)*t.width,y1:25+e.index*t.height,x2:(o.date-1)*t.width,y2:(o.index-e.index)*t.height},n.origin={x1:n.coordinate.x1,y1:n.coordinate.y1,x2:n.coordinate.x2,y2:n.coordinate.y2})})}moveCoord(e,t){e.dependency instanceof Array&&e.dependency.forEach(n=>{n.coordinate.x2=n.origin.x2-t}),this.tasks.filter(n=>n.dependency).forEach(n=>{n.dependency.filter(o=>o.id==e.id).forEach(o=>{o.coordinate.x2=o.origin.x2+t})})}moveCoord2(e,t){e.dependency instanceof Array&&e.dependency.forEach(n=>{n.coordinate.x1=n.origin.x1+t})}reArrangeCoord(e){let t=this;this.tasks.filter(n=>n.dependency).forEach(n=>{n.dependency.filter(o=>o.id==e.id).length>0&&t.calculatorCoordT(n)})}}const ne={class:"card",style:{position:"absolute",top:"50px"}},ae={id:"PMSGanttChart",style:{height:"100%"}},se={key:0},de=["width","height"],ie=["y","x"],oe={class:"card",id:"sliderBar"},b=570,le=50,H=114,re={__name:"PMSGantt",props:["fromPage"],setup(k){const e=m(window.innerHeight-200),t=m([window.innerWidth-b-2,e.value-H]),n=m(70),o=m(0),p=m({"max-width":n.value+"px","min-width":n.value+"px",width:n.value+"px"}),f=K({get:()=>I.value.slice(o.value,o.value+parseInt(t.value[0]/n.value+2))}),I=m([]);for(let c=0;c<100+parseInt(t.value[0]/n.value+2);c++)I.value.push({field:c+1+"th",header:c+1+"th",date:P(c)});function P(c){var r=new Date;return r.setDate(r.getDate()+c),r.getMonth()+1+"-"+r.getDate()}const _=m(new te([{id:1,name:"Task-1",date:40,progress:50,duration:1,dependency:[{id:14}]},{id:2,name:"Task-2",date:6,progress:100,duration:5},{id:3,name:"Task-3",date:6,progress:100,duration:5,dependency:[{id:4}]},{id:4,name:"Task-4",date:11,progress:100,duration:4,dependency:[{id:7}]},{id:5,name:"Task-5",date:27,progress:100,duration:10},{id:6,name:"Task-6",date:1,progress:100,duration:5,dependency:[{id:2},{id:3}]},{id:7,name:"Task-7",date:15,progress:100,duration:3,dependency:[{id:9},{id:10},{id:11},{id:12},{id:13}]},{id:8,name:"Task-8",date:37,progress:100,duration:3},{id:9,name:"Task-9",date:18,progress:100,duration:9},{id:10,name:"Task-10",date:18,progress:100,duration:9},{id:11,name:"Task-11",date:18,progress:100,duration:9},{id:12,name:"Task-12",date:18,progress:100,duration:9},{id:13,name:"Task-13",date:18,progress:100,duration:9},{id:14,name:"Task-14",date:41,progress:0,duration:9},{}],n.value,le)),A=K({get:()=>_.value.tasks}),L=m({position:"absolute",left:b+"px",top:H+"px",width:"calc(100vw - "+b+"px)",height:"inherit","max-height":"calc("+e.value+"px - "+H+"px)"}),N=m({left:b+"px",width:"calc(100vw - "+b+"px )"}),U=m(_.value.tasks.length),W=c=>{let{data:r,newValue:a,field:h}=c;if(typeof r.id>"u")if(h=="name"&&typeof a=="string"){let v={id:U.value,name:U,date:1,duration:1,progress:0};v[h]=a,r.reConstructor(v),_.value._clearUndefined(v.id),_.value._add({}),U.value++}else return;else switch(h){case"date":_.value.changeDateTask(r,a);break;case"duration":_.value.changeDurationTask(r,a);break;case"endDate":let v=a-r.date+1;_.value.changeDurationTask(r,v>0?v:1);break;default:r[h]=a;break}},C=m(0);return $(()=>{document.querySelector("tbody.p-datatable-tbody").addEventListener("scroll",r=>{C.value=-event.target.scrollTop}),document.getElementById("TaskSVGrid").addEventListener("wheel",r=>{let a=document.querySelector("tbody.p-datatable-tbody");const h=event.wheelDeltaY/10;if(a.scrollTop-h<0)C.value=0;else if(a.scrollTop+a.clientHeight==a.scrollHeight)if(h>0)C.value-=h,a.scrollTop=C.value;else return;else a.scrollTop-=h,C.value=a.scrollTop}),window.addEventListener("resize",c);function c(){t.value[0]=document.getElementById("TaskSVGrid").clientWidth-2,t.value[1]=document.getElementById("TaskSVGrid").clientHeight}}),(c,r)=>{const a=x("Column"),h=x("Row"),v=x("ColumnGroup"),R=x("InputText"),j=x("Button"),G=x("InputNumber"),q=x("DataTable"),F=Q,Y=x("Slider");return u(),w("div",ne,[B("div",ae,[l(q,{value:d(_).tasks,class:"p-datatable-sm",showGridlines:!0,editMode:"cell",onCellEditComplete:W},{default:y(()=>[l(v,{type:"header"},{default:y(()=>[l(h,null,{default:y(()=>[l(a,{header:"Task명",rowspan:d(f).length,"header-class":"widthMin2",class:"p-frozen-column"},null,8,["rowspan"]),l(a,{header:"시작일",rowspan:d(f).length,"header-class":"widthMin2"},null,8,["rowspan"]),l(a,{header:"기간",rowspan:d(f).length,"header-class":"widthMin1"},null,8,["rowspan"]),l(a,{header:"종료일",rowspan:d(f).length,"header-class":"widthMin2"},null,8,["rowspan"]),l(a,{header:"담당자",rowspan:d(f).length,"header-class":"widthMin2"},null,8,["rowspan"]),l(a,{header:"진행률",rowspan:d(f).length,"header-class":"widthMin2"},null,8,["rowspan"]),l(a,{header:"2022",colspan:d(f).length},null,8,["colspan"])]),_:1}),l(h,null,{default:y(()=>[(u(!0),w(S,null,E(d(f),s=>(u(),T(a,{header:s.date,style:V(d(p))},null,8,["header","style"]))),256))]),_:1}),l(h,null,{default:y(()=>[(u(!0),w(S,null,E(d(f),s=>(u(),T(a,{header:s.header,style:V(d(p))},null,8,["header","style"]))),256))]),_:1})]),_:1}),l(a,{field:"name","body-class":"widthMin2",frozen:""},{editor:y(({data:s,field:g})=>[l(R,{modelValue:s[g],"onUpdate:modelValue":D=>s[g]=D,autofocus:""},null,8,["modelValue","onUpdate:modelValue"])]),body:y(s=>[s.data.id?(u(),w("span",se,X(s.data.name),1)):(u(),T(j,{key:1,type:"button",icon:"pi pi-plus",class:"mr-2"}))]),_:1}),l(a,{field:"date","body-class":"widthMin2",frozen:""},{editor:y(({data:s,field:g})=>[s.id?(u(),T(G,{key:0,inputId:"integeronly",modelValue:s[g],"onUpdate:modelValue":D=>s[g]=D,autofocus:""},null,8,["modelValue","onUpdate:modelValue"])):M("",!0)]),_:1}),l(a,{field:"duration","body-class":"widthMin1",frozen:""},{editor:y(({data:s,field:g})=>[s.id?(u(),T(G,{key:0,inputId:"integeronly",modelValue:s[g],"onUpdate:modelValue":D=>s[g]=D,autofocus:""},null,8,["modelValue","onUpdate:modelValue"])):M("",!0)]),_:1}),l(a,{field:"endDate","body-class":"widthMin2",frozen:""},{editor:y(({data:s,field:g})=>[s.id?(u(),T(G,{key:0,inputId:"integeronly",modelValue:s[g],"onUpdate:modelValue":D=>s[g]=D,autofocus:""},null,8,["modelValue","onUpdate:modelValue"])):M("",!0)]),_:1}),l(a,{header:"담당자",field:"manager","body-class":"widthMin2"}),l(a,{header:"진행률",field:"progress","body-class":"widthMin2"}),(u(!0),w(S,null,E(d(I),s=>(u(),T(a,{field:s.field,header:s.header,key:s.id,style:V(d(p))},null,8,["field","header","style"]))),128))]),_:1},8,["value"]),B("div",{id:"TaskSVGrid",style:V(d(L))},[(u(),w("svg",{width:d(t)[0]+"px",height:d(t)[1]+"px"},[(u(),w("svg",{width:"10000px",height:"10000px",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",y:d(C),x:-d(o)*d(n),style:{transition:"y 1s ease-out"}},[(u(!0),w(S,null,E(d(A),s=>(u(),w("svg",null,[s.id?(u(),T(F,{key:0,taskD:s,taskList:d(_),bWidth:d(n)},null,8,["taskD","taskList","bWidth"])):M("",!0)]))),256))],8,ie))],8,de))],4)]),B("div",oe,[l(Y,{modelValue:d(o),"onUpdate:modelValue":r[0]||(r[0]=s=>ee(o)?o.value=s:null),style:V(d(N))},null,8,["modelValue","style"])])])}}},ge=Z(re,[["__scopeId","data-v-2709236c"]]);export{ge as default};
